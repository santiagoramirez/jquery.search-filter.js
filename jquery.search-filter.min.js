/*!
 * searchFilter v0.2.1
 * Santiago Ramirez
 */
jQuery.fn.searchFilter=function(e){var t={url:"",data:{},dataType:"json",autoUpdate:!0,rememberSearch:!1,nextSelector:jQuery(this).selector+" .sf-next",prevSelector:jQuery(this).selector+" .sf-prev",clearAllSelector:jQuery(this).selector+" .sf-clear-all",loadMoreSelector:jQuery(this).selector+" .sf-load-more",submitSelector:jQuery(this).selector+" .sf-submit",pageVar:"page",perPageVar:"per_page",offsetVar:"offset",templateEngine:"mustache",template:!1,before:!1,success:!1,error:!1};for(option in t)void 0===e[option]&&(e[option]=t[option]);var a={},r=jQuery.extend({},e.data),l=function(){if(jQuery(this).find("ul.sf-list li").click(i),jQuery(this).find("input.sf-input").doneTyping(s,500),jQuery(this).find("select.sf-select").change(s),e.clearAllSelector&&jQuery(e.clearAllSelector).click(a.clearAll),e.loadMoreSelector&&jQuery(e.loadMoreSelector).click(a.loadMore),e.submitSelector&&jQuery(e.submitSelector).click(a.submit),e.rememberSearch===!0){var t=d();t&&(e.data=t)}e.pageVar&&(e.data[e.pageVar]||(e.data[e.pageVar]=1)),e.perPageVar&&(e.data[e.perPageVar]||(e.data[e.perPageVar]=10)),e.template&&(e.templateSelector=e.template,e.template=jQuery(e.template).html(),Mustache.parse(e.template),jQuery(e.templateSelector).html("")),f(),a.submit()}.bind(this),s=function(){o(jQuery(this).attr("name"),jQuery(this).val()),n(1),e.autoUpdate===!0&&a.submit()},i=function(){var t=jQuery(this).closest("ul[data-name]"),r=t.attr("data-name"),l=jQuery(this).attr("data-value"),s=jQuery(this).hasClass("selected"),i=jQuery(this).closest("ul[data-name]").hasClass("multi-select");s?(i||u(r),jQuery(this).removeClass("selected")):(i||(t.find("li").removeClass("selected"),o(r,l)),jQuery(this).addClass("selected")),n(1),e.autoUpdate===!0&&a.submit()},n=function(t){e.pageVar&&(e.data[e.pageVar]=t)},o=function(t,a){""!=a?(e.data[t]=a,e.rememberSearch===!0&&c()):u(t)},u=function(t){delete e.data[t],e.rememberSearch===!0&&c()},c=function(){var t=window.location.pathname.replace(/([\W]+)/g,"");localStorage.setItem("search_filter_"+t,JSON.stringify(e.data))},d=function(){var e=window.location.pathname.replace(/([\W]+)/g,"");return JSON.parse(localStorage.getItem("search_filter_"+e))},f=function(){jQuery(this).find("ul.sf-list li").removeClass("selected"),jQuery(this).find("input.sf-input").val(""),jQuery(this).find("select.sf-select").val("");for(key in e.data)if("string"==typeof e.data[key]||e.data[key]instanceof String){var t=jQuery(this).find('ul.sf-list[data-name="'+key+'"] li[data-value="'+e.data[key]+'"]'),a=jQuery(this).find('[name="'+key+'"]');t.length?t.addClass("selected"):a.length&&a.val(e.data[key])}else"array"==typeof e.data[key]||(e.data[key],Array)}.bind(this);return a.clearAll=function(){e.data=r,c(),f(),a.submit()},a.prev=function(){e.data[e.pageVar]&&(e.data[e.pageVar]--,c()),a.submit()},a.next=function(){e.data[e.pageVar]&&(e.data[e.pageVar]++,c()),a.submit()},a.loadMore=function(){a.next()},a.submit=function(){e.before&&e.before(e.data),jQuery.ajax({url:e.url,data:e.data,dataType:e.dataType,success:function(t,a,r){if(e.success&&e.success(t,a,r),e.template){var l=Mustache.render(e.template,{data:t});jQuery(e.templateSelector).hide(),jQuery(e.templateSelector).html(l),jQuery(e.templateSelector).fadeIn()}},error:function(t){e.error&&e.error(t)}})},l(),jQuery(a).data("searchFilter",this),this},jQuery.fn.doneTyping=function(e,t){var a;jQuery(this).keyup(function(){clearTimeout(a),a=setTimeout(e.bind(this),t)}),jQuery(this).keydown(function(){clearTimeout(a)})};