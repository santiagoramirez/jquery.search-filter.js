/*!
 * searchFilter v0.3.0
 * Santiago Ramirez
 */
jQuery.fn.searchFilter=function(e){var t={url:"",data:{},dataType:"json",autoUpdate:!0,rememberSearch:!1,nextSelector:jQuery(this).selector+" .sf-next",prevSelector:jQuery(this).selector+" .sf-prev",clearAllSelector:jQuery(this).selector+" .sf-clear-all",loadMoreSelector:jQuery(this).selector+" .sf-load-more",submitSelector:jQuery(this).selector+" .sf-submit",pageVar:"page",perPageVar:"per_page",offsetVar:"offset",template:!1,before:!1,success:!1,error:!1};for(option in t)void 0===e[option]&&(e[option]=t[option]);var a,r={},s=jQuery.extend({},e.data),l=function(){if(jQuery(this).find("ul.sf-list li").click(o),jQuery(this).find("input.sf-input").doneTyping(i,500),jQuery(this).find("select.sf-select").change(i),e.clearAllSelector&&jQuery(e.clearAllSelector).click(r.clearAll),e.loadMoreSelector&&jQuery(e.loadMoreSelector).click(r.loadMore),e.submitSelector&&jQuery(e.submitSelector).click(r.submit),e.rememberSearch===!0){var t=f();t&&(e.data=t)}e.pageVar&&(e.data[e.pageVar]||(e.data[e.pageVar]=1)),e.perPageVar&&(e.data[e.perPageVar]||(e.data[e.perPageVar]=10)),e.template&&("undefined"!=typeof Mustache?(a=!0,e.templateSelector=e.template,e.template=jQuery(e.template).html(),Mustache.parse(e.template),jQuery(e.templateSelector).html("")):(a=!1,console.error("Mustache is not defined. If you'd like to use the built in Mustache integration, please include it before this script https://github.com/janl/mustache.js"))),p(),r.submit()}.bind(this),i=function(){u(jQuery(this).attr("name"),jQuery(this).val()),n(1),e.autoUpdate===!0&&r.submit()},o=function(){var t=jQuery(this).closest("ul[data-name]"),a=t.attr("data-name"),s=jQuery(this).attr("data-value"),l=jQuery(this).hasClass("selected"),i=jQuery(this).closest("ul[data-name]").hasClass("multi-select");l?(i||c(a),jQuery(this).removeClass("selected")):(i||(t.find("li").removeClass("selected"),u(a,s)),jQuery(this).addClass("selected")),n(1),e.autoUpdate===!0&&r.submit()},n=function(t){e.pageVar&&(e.data[e.pageVar]=t)},u=function(t,a){""!=a?(e.data[t]=a,e.rememberSearch===!0&&d()):c(t)},c=function(t){delete e.data[t],e.rememberSearch===!0&&d()},d=function(){var t=window.location.pathname.replace(/([\W]+)/g,"");localStorage.setItem("search_filter_"+t,JSON.stringify(e.data))},f=function(){var e=window.location.pathname.replace(/([\W]+)/g,"");return JSON.parse(localStorage.getItem("search_filter_"+e))},p=function(){jQuery(this).find("ul.sf-list li").removeClass("selected"),jQuery(this).find("input.sf-input").val(""),jQuery(this).find("select.sf-select").val("");for(key in e.data)if("string"==typeof e.data[key]||e.data[key]instanceof String){var t=jQuery(this).find('ul.sf-list[data-name="'+key+'"] li[data-value="'+e.data[key]+'"]'),a=jQuery(this).find('[name="'+key+'"]');t.length?t.addClass("selected"):a.length&&a.val(e.data[key])}else"array"==typeof e.data[key]||(e.data[key],Array)}.bind(this);return r.clearAll=function(){e.data=s,d(),p(),r.submit()},r.prev=function(){e.data[e.pageVar]&&(e.data[e.pageVar]--,d()),r.submit()},r.next=function(){e.data[e.pageVar]&&(e.data[e.pageVar]++,d()),r.submit()},r.loadMore=function(){r.next()},r.submit=function(){e.before&&e.before(e.data),jQuery.ajax({url:e.url,data:e.data,dataType:e.dataType,success:function(t,r,s){if(e.success&&e.success(t,r,s),e.template&&a){var l=Mustache.render(e.template,{data:t});jQuery(e.templateSelector).hide(),jQuery(e.templateSelector).html(l),jQuery(e.templateSelector).fadeIn()}},error:function(t){e.error&&e.error(t)}})},l(),jQuery(r).data("searchFilter",this),this},jQuery.fn.doneTyping=function(e,t){var a;jQuery(this).keyup(function(){clearTimeout(a),a=setTimeout(e.bind(this),t)}),jQuery(this).keydown(function(){clearTimeout(a)})};