/*!
 * Plugin Name: searchFilter
 * Plugin Version: 0.0.0
 * Author Santiago Ramirez
 */
jQuery.fn.searchFilter=function(e){var t={url:"",data:{},dataType:"json",autoUpdate:!0,rememberSearch:!1,nextSelector:jQuery(this).selector+" .s-next",prevSelector:jQuery(this).selector+" .s-prev",clearAllSelector:jQuery(this).selector+" .s-clear-all",loadMoreSelector:jQuery(this).selector+" .s-load-more",submitSelector:jQuery(this).selector+" .s-submit",pageVar:"page",perPageVar:"per_page",offsetVar:"offset",before:!1,success:!1,error:!1};for(option in t)void 0===e[option]&&(e[option]=t[option]);var a={},r=jQuery.extend({},e.data),i=function(){if(jQuery(this).find("ul.filter-list li").click(s),jQuery(this).find("input.filter-input").doneTyping(l,500),jQuery(this).find("select.filter-select").change(l),e.clearAllSelector&&jQuery(e.clearAllSelector).click(a.clearAll),e.loadMoreSelector&&jQuery(e.loadMoreSelector).click(a.loadMore),e.submitSelector&&jQuery(e.submitSelector).click(a.submit),e.rememberSearch===!0){var t=d();t&&(e.data=t)}e.pageVar&&(e.data[e.pageVar]||(e.data[e.pageVar]=1)),e.perPageVar&&(e.data[e.perPageVar]||(e.data[e.perPageVar]=10)),f()}.bind(this),l=function(){o(jQuery(this).attr("name"),jQuery(this).val()),n(1),e.autoUpdate===!0&&a.submit()},s=function(){var t=jQuery(this).closest("ul[data-name]"),r=t.attr("data-name"),i=jQuery(this).attr("data-value"),l=jQuery(this).hasClass("selected"),s=jQuery(this).closest("ul[data-name]").hasClass("multi-select");l?(s||u(r),jQuery(this).removeClass("selected")):(s||(t.find("li").removeClass("selected"),o(r,i)),jQuery(this).addClass("selected")),n(1),e.autoUpdate===!0&&a.submit()},n=function(t){e.pageVar&&(e.data[e.pageVar]=t)},o=function(t,a){""!=a?(e.data[t]=a,e.rememberSearch===!0&&c()):u(t)},u=function(t){delete e.data[t],e.rememberSearch===!0&&c()},c=function(){var t=window.location.pathname.replace(/([\W]+)/g,"");localStorage.setItem("search_filter_"+t,JSON.stringify(e.data))},d=function(){var e=window.location.pathname.replace(/([\W]+)/g,"");return JSON.parse(localStorage.getItem("search_filter_"+e))},f=function(){jQuery(this).find("ul.filter-list li").removeClass("selected"),jQuery(this).find("input.filter-input").val(""),jQuery(this).find("select.filter-select").val("");for(key in e.data)if("string"==typeof e.data[key]||e.data[key]instanceof String){var t=jQuery(this).find('ul.filter-list[data-name="'+key+'"] li[data-value="'+e.data[key]+'"]'),a=jQuery(this).find('[name="'+key+'"]');t.length?t.addClass("selected"):a.length&&a.val(e.data[key])}else"array"==typeof e.data[key]||(e.data[key],Array)}.bind(this);return a.clearAll=function(){e.data=r,c(),f(),a.submit()},a.prev=function(){e.data[e.pageVar]&&(e.data[e.pageVar]--,c()),a.submit()},a.next=function(){e.data[e.pageVar]&&(e.data[e.pageVar]++,c()),a.submit()},a.loadMore=function(){a.next()},a.submit=function(){e.before&&e.before(e.data),jQuery.ajax({url:e.url,data:e.data,dataType:e.dataType,success:function(t,a,r){e.success&&e.success(t,a,r)},error:function(t){e.error&&e.error(t)}})},i(),jQuery(a).data("searchFilter",this),this},jQuery.fn.doneTyping=function(e,t){var a;jQuery(this).keyup(function(){clearTimeout(a),a=setTimeout(e.bind(this),t)}),jQuery(this).keydown(function(){clearTimeout(a)})};