/*!
 * searchFilter v0.2.0
 * Santiago Ramirez
 */
jQuery.fn.searchFilter=function(e){var a={url:"",data:{},dataType:"json",autoUpdate:!0,rememberSearch:!1,nextSelector:jQuery(this).selector+" .sf-next",prevSelector:jQuery(this).selector+" .sf-prev",clearAllSelector:jQuery(this).selector+" .sf-clear-all",loadMoreSelector:jQuery(this).selector+" .sf-load-more",submitSelector:jQuery(this).selector+" .sf-submit",pageVar:"page",perPageVar:"per_page",offsetVar:"offset",before:!1,success:!1,error:!1};for(option in a)void 0===e[option]&&(e[option]=a[option]);var t={},r=jQuery.extend({},e.data),s=function(){if(jQuery(this).find("ul.sf-list li").click(l),jQuery(this).find("input.sf-input").doneTyping(i,500),jQuery(this).find("select.sf-select").change(i),e.clearAllSelector&&jQuery(e.clearAllSelector).click(t.clearAll),e.loadMoreSelector&&jQuery(e.loadMoreSelector).click(t.loadMore),e.submitSelector&&jQuery(e.submitSelector).click(t.submit),e.rememberSearch===!0){var a=d();a&&(e.data=a)}e.pageVar&&(e.data[e.pageVar]||(e.data[e.pageVar]=1)),e.perPageVar&&(e.data[e.perPageVar]||(e.data[e.perPageVar]=10)),f()}.bind(this),i=function(){o(jQuery(this).attr("name"),jQuery(this).val()),n(1),e.autoUpdate===!0&&t.submit()},l=function(){var a=jQuery(this).closest("ul[data-name]"),r=a.attr("data-name"),s=jQuery(this).attr("data-value"),i=jQuery(this).hasClass("selected"),l=jQuery(this).closest("ul[data-name]").hasClass("multi-select");i?(l||u(r),jQuery(this).removeClass("selected")):(l||(a.find("li").removeClass("selected"),o(r,s)),jQuery(this).addClass("selected")),n(1),e.autoUpdate===!0&&t.submit()},n=function(a){e.pageVar&&(e.data[e.pageVar]=a)},o=function(a,t){""!=t?(e.data[a]=t,e.rememberSearch===!0&&c()):u(a)},u=function(a){delete e.data[a],e.rememberSearch===!0&&c()},c=function(){var a=window.location.pathname.replace(/([\W]+)/g,"");localStorage.setItem("search_filter_"+a,JSON.stringify(e.data))},d=function(){var e=window.location.pathname.replace(/([\W]+)/g,"");return JSON.parse(localStorage.getItem("search_filter_"+e))},f=function(){jQuery(this).find("ul.sf-list li").removeClass("selected"),jQuery(this).find("input.sf-input").val(""),jQuery(this).find("select.sf-select").val("");for(key in e.data)if("string"==typeof e.data[key]||e.data[key]instanceof String){var a=jQuery(this).find('ul.sf-list[data-name="'+key+'"] li[data-value="'+e.data[key]+'"]'),t=jQuery(this).find('[name="'+key+'"]');a.length?a.addClass("selected"):t.length&&t.val(e.data[key])}else"array"==typeof e.data[key]||(e.data[key],Array)}.bind(this);return t.clearAll=function(){e.data=r,c(),f(),t.submit()},t.prev=function(){e.data[e.pageVar]&&(e.data[e.pageVar]--,c()),t.submit()},t.next=function(){e.data[e.pageVar]&&(e.data[e.pageVar]++,c()),t.submit()},t.loadMore=function(){t.next()},t.submit=function(){e.before&&e.before(e.data),jQuery.ajax({url:e.url,data:e.data,dataType:e.dataType,success:function(a,t,r){e.success&&e.success(a,t,r)},error:function(a){e.error&&e.error(a)}})},s(),jQuery(t).data("searchFilter",this),this},jQuery.fn.doneTyping=function(e,a){var t;jQuery(this).keyup(function(){clearTimeout(t),t=setTimeout(e.bind(this),a)}),jQuery(this).keydown(function(){clearTimeout(t)})};